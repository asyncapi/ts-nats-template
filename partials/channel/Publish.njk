
{% macro publish(channelName, parameters, publishMessage, server) %}

export function publish(
  requestMessage: {{publishMessage.uid() | pascalCase}}Message, 
  {% if parameters | length %}
    {{parameters | realizeParametersForChannel}}
  {% endif %}{% if parameters | length %},{% endif %}
  nc?: Client
  ): Promise<void> {
  return new Promise<void>(async (resolve, reject) => {
    if (nc) {
      try{
        let publishDataHooks = hooks.getHooks(AvailableHooks.BeforeSendingData) as hooks.BeforeSendingDataHook[];
        var dataToPublish;
        for(let hook in publishDataHooks){
          dataToPublish = hook(requestMessage);
        }
        nc.publish(realizeChannelName('{{channelName}}', {
          {% for parameterName, parameter in parameters %}
            "{{parameterName}}": {{parameterName}}
          {% endfor %}
        }), dataToPublish);
        resolve();
      }catch(e){
        reject(e);
      }
    }else{
      reject(new Error("Nats client is not connected"));
    }
  });
};
{% endmacro %}
